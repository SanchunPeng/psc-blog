(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21026c"],{b756:function(s,t,a){"use strict";a.r(t);var n=function(){var s=this,t=s.$createElement;s._self._c;return s._m(0)},e=[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("section",[a("h1",[s._v("跨域")]),a("h2",[s._v("1、同源策略限制：")]),a("ul",[a("li",[s._v("1.) Cookie、LocalStorage 和 IndexDB 无法读取")]),a("li",[s._v("2.) DOM 和 Js对象无法获得")]),a("li",[s._v("3.) AJAX 请求不能发送")])]),a("h2",[s._v("2、没有同源策略的危害：")]),a("ul",[a("li",[s._v("1、用户在一个页面有过登录态之后，其他页面都会被服务端识别为已登录\n(如购物网站、银行网站影响非常大)——类似XSRF(跨站请求伪造)")]),a("li",[s._v("2、不同的域名cookie是分开进行存储。同源策略，规定www.b.html页面不允许请求www.a.html域名的数据")]),a("li",[s._v("3、我们会发现，其实www.a.html的cookie也是明文的，我们还是可以想办\n法获取到。然后在www.b.html域名在伪造同样的cookie即可。\n服务端安全机制，设置httpOnly属性。这样返回的cookie值，存入到浏\n览器后，前端不可操作。")])]),a("h2",[s._v("2、跨域解决方案")]),a("p",[s._v("接口跨域：")]),a("ul",[a("li",[s._v("JSONP(GET)")]),a("li",[s._v("JOONP(POST)")]),a("li",[s._v("Nginx代理")]),a("li",[s._v("CORS\nDOM跨域：")]),a("li",[s._v("postMessage")]),a("li",[s._v("document.domain")]),a("li",[s._v("document.name\n在同源策略影响下，一个域名A的网页可以获取域名B下的脚本，css，图片等，但是不能发送Ajax请求，也不能操作Cookie、LocalStorage等数据。AJAX通信默认情况下，XHR对象只能访问与包含它的页面位于同一个域(协议，域名，端口相同)中的资源(使用 XMLHttpRequest 对象发起 HTTP 请求就必须遵守同源策略。)，这种安全策略可以防止某些恶意行为。")])]),a("h3",[s._v("1）JSONP(GET)")]),a("p",[s._v("标签可跨域，可以通过动态的srcript绕过同源策略，服务端通过返回一个预先定义好的函数调用，并将要返回的数据通过参数传递过来")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-JavaScript"}},[s._v("    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" script = "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".createElement("),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"script"')]),s._v(");\n    script.src = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"http://localhost:3000/api/jsonp?callback=handleResponse"')]),s._v(";\n    "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".body.insertBefore(script);\n    \n    "),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("handleResponse")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("res")]),s._v(")")]),s._v("{"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//返回立即执行的全局函数")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v("(res);\n    }\n")])]),a("h3",[s._v("PS：")]),a("p",[s._v("callback是前后端约定好的传递方法名称的参数")]),a("ul",[a("li",[s._v("优点：简单易用，能够直接访问响应文本，支持浏览器与服务器之间的双向通信。")]),a("li",[s._v("缺点：安全性：如果其他域不安全很可能夹杂这恶意的相应代码。这时候只能弃用，没法追究。不容易确定JSONP请求是否失败，HTML5给<script/>元素新增了一个onerror函数，可以指定计时器测试指定的时间内是否接收到相应。")])]),a("h3",[s._v("2）JSONP(POST)")]),a("p",[s._v("可以通过创建隐藏的form实现post")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" handleJsonpPost = "),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("{url, data}")]),s._v(") ")]),s._v("{\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" = "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".createElement("),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'form'")]),s._v(")\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" input = "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".createElement("),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'input'")]),s._v(")\n    form.action = url\n    form.method = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'POST'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" data) {\n        input.name = name\n        input.value = data[name].toString()\n        form.appendChild(input.cloneNode())\n    }\n    form.style.display = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'none'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".body.appendChild(form)\n    form.submit()\n    "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".body.removeChild(form)\n}\n\nhandleJsonpPost({\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("url")]),s._v(": "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'http://localhost:3000/api/jsonp'")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": {\n        "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("msg")]),s._v(": "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'hello world'")]),s._v("\n    }\n})\n\n")])]),a("p",[s._v("PS：如果需要在请求返回时再执行一些操作，可以通过创建iframe")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" iframe = "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".createElement("),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'iframe'")]),s._v(")\n    iframe.name = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'jsonpost'")]),s._v("\n    iframe.style.display = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'none'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".body.appendChild(iframe)\n    iframe.addEventListener("),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'load'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n        "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'success'")]),s._v(")\n    })\n    form.target = iframe.name   "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 上文中的form")]),s._v("\n")])]),a("h3",[s._v("3）Nginx代理")]),a("p",[s._v("跨域问题是浏览器的安全机制。nginx代理，就是将浏览器的请求，通过\nnginx代理发送到正真的后端域名上。真正发送请求的不是浏览器，故不\n存在跨域问题。")]),a("h3",[s._v("4）CORS：支持POST")]),a("p",[s._v("普通跨域请求：只服务端设置Access-Control-Allow-Origin表示可接受的跨域请求。\n非简单请求：会在正式通信之前增加一次HTTP查询请求，成为预检preflight请求，这种情况下出了设置origin，还需要设置Access-Control-Request-Header")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":""}},[s._v("// 简单请求\nctx.set('Access-Control-Allow-Origin', '*')\nctx.set('Access-Control-Allow-Credetials', true)\nctx.set('Access-Control-Request-Method', 'PUT, POST, GET, DELETE, OPTIONS')\n// 非简单请求\nctx.set('Access-Control-Request-Header', 'Origin, X-Requested-Width, Content-Type, Accept, X-PINGOTHER')\n")])]),a("h4",[s._v("PS：")]),a("p",[s._v("CORS提供了一种跨域请求方案，但没有为安全访问提供足够的保障机制。\n使用onload（收到完整响应时触发），onerror（在请求发生错误时触发）。\njsonp是get形式，承载的信息量有限，所以信息量较大时CORS是不二选择；")]),a("h3",[s._v("5）postMessage")]),a("p",[s._v("window.postMessage(message,targetOrigin) 方法是html5新引进的特性，可\n以使用它来向其它的window对象发送消息，无论这个window对象是属于同\n源或不同源，目前IE8+、FireFox、Chrome、Opera等浏览器都已经支持\nwindow.postMessage方法。")]),a("p",[s._v("www.a.com:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-JavaScript"}},[a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 接收信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".addEventListener("),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"message"')]),s._v(", receiveMessage, "),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(");\n"),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("receiveMessage")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("event")]),s._v(")\n")]),s._v("{\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" origin = event.origin\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (origin !== "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"http://www.b.com"')]),s._v(")\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(";\n}\n\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 发送信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" iframe = "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".getElementById("),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'iframe'")]),s._v(")\niframe.contentWindow.postMessage({"),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("hello")]),s._v(": "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'hello b'")]),s._v("}, "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'http://www.a.com'")]),s._v(")\n")])]),a("p",[s._v("www.b.com:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-JavaScript"}},[a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 接收信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".addEventListener("),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"message"')]),s._v(", receiveMessage, "),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(");\n"),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("receiveMessage")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("event")]),s._v(")\n")]),s._v("{\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" origin = event.origin\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (origin !== "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"http://www.a.com"')]),s._v(")\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(";\n}\n\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 发送信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".postMessage({"),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("hello")]),s._v(": "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'hi a'")]),s._v("}, "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'http://www.b.com'")]),s._v(")\n")])]),a("h3",[s._v("6）document.domain")]),a("p",[s._v("对于主域相同的可以把document.domain设置成自身或更高一级的父域")]),a("h3",[s._v("7）document.name")]),a("p",[s._v("window对象有个name属性，在一个窗口(window)的生命周期内,窗口载入的\n所有的页面都是共享一个window.name的，每个页面对window.name都有读\n写的权限，window.name是持久存在一个窗口载入过的所有页面中的，并不\n会因新页面的载入而进行重置。所以可以通过window.name进行传值")])])}],r=a("6691"),l={},p=Object(r["a"])(l,n,e,!1,null,null,null);t["default"]=p.exports}}]);