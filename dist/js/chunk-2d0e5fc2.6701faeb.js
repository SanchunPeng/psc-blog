(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e5fc2"],{"978f":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},o=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",[n("h1",[e._v("移动端兼容性采坑之旅")]),n("h2",[e._v("1. 移动端在Ajax回调方法中通过window.open方法会被浏览器拦截(_self不会限制)")]),n("p",[e._v("原因：在ajax的回调方法中使用window.open()方法，浏览器会认为这不是用户主动触发的动作，所以是不安全的，故被浏览器拦截。")]),n("p",[e._v("解决办法1：设置ajax的async:false,完成整个ajax之后再执行是可行的，缺点是：如果响应时间太长，JS为单线程的，页面就会卡顿，并容易失去响应。")]),n("p",[e._v('解决方法2：在运行ajax之前先w=window.open("","")，预先打开一个空的或者设定好网页，页面中可以显示"拼命加载中..."的loading，在完成ajax后将w.location=url;重新给w地址赋值。缺点是：用户体验略差，因为无论成功和失败都会打开一个新窗口。')]),n("pre",{pre:!0},[n("code",{pre:!0,attrs:{"v-pre":""}},[e._v("        const tmpWin  = window.open()\n        ajax(xxx, handle(){ \n            //回调函数\n            tmpWin.location.href = url;\n        })\n")])]),n("p",[e._v("解决方法3：采用settimeout()轮询的方式，定时检查ajax过程是否完成，在ajax中设定标识变量，完成后在window.open(url)；缺点是：部分移动浏览器无效")]),n("p",[e._v("解决方法4：同方法2，在页面中加入"),n("iframe",{staticStyle:{display:"none"},attrs:{name:"fakeframe"}}),e._v("，在ajax回调用改变location的地址，与方法2不同的是iframe是在当前页，并且隐藏，不用弹窗，效果略好，缺点是：部分移动浏览器无效。")]),n("p",[e._v("解决办法5：使用a标签")]),n("pre",{pre:!0},[n("code",{pre:!0,attrs:{"v-pre":""}},[e._v("        let a = document.getElementById('targetA')\n        if (!a) {\n          a = document.createElement('a')\n          a.setAttribute('href', url)\n          a.setAttribute('target', '_blank')\n          a.setAttribute('id', 'targetA')\n          document.body.appendChild(a)\n        } else {\n          a.style.href = url\n        }\n        a.click()\n")])]),n("p",[e._v("缺点是：部分移动浏览器无效。")]),n("h2",[e._v("2. 使用overflow滑动，在android 6.0.1以下自带浏览器不能滑动")]),n("p",[e._v("解决方案：定义touchStart，touchMove事件，设置scrollLeft或者scrollTop")]),n("pre",{pre:!0},[n("code",{pre:!0,attrs:{"v-pre":""}},[e._v("const touchStartPosition = new THREE.Vector2()\nbind(this.listDom, 'touchstart', (event) => {\n    touchStartPosition.set(event.touches[0].pageX, event.touches[0].pageY)\n}, false)\n\nbind(this.listDom, 'touchmove', (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    const deltaY = event.touches[0].pageY - touchStartPosition.y\n    touchStartPosition.set(event.touches[0].pageX, event.touches[0].pageY)\n    this.listDom.scrollTop += -deltaY\n}, false)\n")])])])}],r=n("6691"),s={},i=Object(r["a"])(s,a,o,!1,null,null,null);t["default"]=i.exports}}]);